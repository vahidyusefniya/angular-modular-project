<!--suppress JSUnresolvedReference -->
<ion-modal
  class="order__state__logs__modal"
  (willDismiss)="onDismiss()"
  [isOpen]="isOpen"
>
  <ng-template>
    <ion-header>
      <ion-toolbar class="px-3">
        <ion-buttons slot="start">
          <ion-button (click)="onDismiss()" color="primary">
            {{ dictionary.Close }}
          </ion-button>
        </ion-buttons>
        <ion-title>{{ dictionary.OrderId }}: {{ order?.buyOrderId }}</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-card class="p-3" *ngIf="!order?.isPhysicalProduct">
        <ion-grid fixed class="ion-no-padding">
          <ion-row>
            <ion-col size="12" sizeMd="6"
              ><ion-label class="text-white"
                >{{ dictionary.Delivery }}:
              </ion-label>
              <ion-label
                *ngIf="order?.buyOrderDelivery?.deliveryType; else delivery"
                >{{ order?.buyOrderDelivery?.deliveryType }}
                  <span *ngIf="!!order?.buyOrderDelivery?.deliveryTypeValue">({{
                    order?.buyOrderDelivery?.deliveryTypeValue
                  }})</span>
                </ion-label
              >
              <ng-template #delivery>
                <ion-label>{{ dictionary.Download }}</ion-label>
              </ng-template>
            </ion-col>
            <ion-col
              size="12"
              sizeMd="6"
              *ngIf="order?.exchangeCalc?.exchangeRate"
              ><ion-label class="text-white"
                >{{ dictionary.ExchangeRate }}:
              </ion-label>
              <ion-label
                >{{ order?.exchangeCalc?.exchangeRate }}
                {{ order?.exchangeCalc?.baseCurrency?.currencyName }} to
                {{
                  order?.exchangeCalc?.targetCurrency?.currencyName
                }}</ion-label
              ></ion-col
            >
          </ion-row>
        </ion-grid>
      </ion-card>
      <div class="p-2">
        <app-page-list
          [label]="dictionary.StateLogs"
          [data]="stateLogs"
          [hasNewButton]="false"
          [hasSearch]="false"
          [cols]="cols"
          [showPagination]="false"
          [hasRefresh]="false"
          [hasAdvancedFilter]="false"
          [hasExport]="false"
          [hasCustomTableContent]="true"
          [initialTemplate]="stateLogsTable"
          [showActionSheet]="false"
        />
        <ng-template #stateLogsTable>
          <p-table
            [value]="stateLogs"
            [columns]="cols"
            responsiveLayout="stack"
            styleClass="p-datatable-gridlines"
            breakpoint="840px"
          >
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th class="column-color" *ngFor="let col of columns">
                  {{ col.header }}
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
              <tr>
                <td
                  class="column-color m-0 py-0"
                  *ngFor="let col of columns; let i = index"
                >
                  <!--suppress JSUnresolvedReference -->
                  <div class="table__row" [ngSwitch]="col.field">
                    <span class="table__label__row me-2">{{ col.header }}</span>
                    <div class="p-3">
                      <span *ngSwitchCase="'createdTime'">
                        {{ rowData[col.field] | convertLocalDateTime }}
                      </span>

                      <div
                        *ngSwitchCase="'state'"
                        class="d-flex align-items-center"
                      >
                        <app-icon
                          *ngIf="rowData[col.field] === 'Complete'"
                          [type]="'Complete'"
                        />

                        <app-icon
                          *ngIf="rowData[col.field] === 'Failed'"
                          [type]="'Failed'"
                        />
                        <app-icon
                          *ngIf="rowData[col.field] === 'Created'"
                          [type]="'Created'"
                        />

                        <app-icon
                          *ngIf="
                            rowData[col.field] != 'Complete' &&
                            rowData[col.field] != 'Failed' &&
                            rowData[col.field] != 'Created' 
                          "
                          [type]="'inProgress__circle'"
                        />
                        <span class="ms-1">{{ rowData[col.field] }}</span>
                      </div>
                      <span *ngSwitchCase="'reason'">
                        {{ rowData[col.field] }}
                      </span>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
              <tr>
                <td
                  class="text-center column-color"
                  [attr.colspan]="columns.length"
                >
                  {{ "NoRecordsFound" }}
                </td>
              </tr>
            </ng-template>
          </p-table>
        </ng-template>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
